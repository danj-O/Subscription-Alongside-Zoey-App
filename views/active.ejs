<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./styles.css" type="text/css">
  <title><%= pageTitle %></title>
</head>
<body>
  <header>
    <%- include('header.ejs', {pagePath: pagePath}) %>
  </header>

  <div class="main-container">
    <% if (customerPurchasesArr.length < 1){ %>
      <p class="loading-p">THERE ARE NO <%= pageTitle %> AT THIS TIME.</p>
      <% } else { %>

        
        <% for(customer in customerPurchasesArr) { 
          var custInstancesArr = customerPurchasesArr[customer].subscriptions.filter(item =>{
            return item.status == pagePath
          })
          if (custInstancesArr.length <= 0){
            %>
            <h2>No records of <%= pagePath %> at this time.</h2>
            <%
          } else{ %>
            <div class="single-customer">
  
              <p class="address"><%= customerPurchasesArr[customer].address %>, <%= customerPurchasesArr[customer].addressOthers.city %>, <%= customerPurchasesArr[customer].addressOthers.region %> <%= customerPurchasesArr[customer].addressOthers.postcode %></p>
              
              <div class="customer-box">
                <div class="customer-info">
                  <p>PHONE: <%= customerPurchasesArr[customer].addressOthers.telephone %></p>
                  <p>addy: <%= customerPurchasesArr[customer].address %></p>
                  <p><%= customerPurchasesArr[customer].name %></p>
                  <p><%= customerPurchasesArr[customer].email %></p>
                </div>
    
                <div class="cust-form">
                  <p>CUSTOMER NOTES: <%= customerPurchasesArr[customer].notes %></p>
                  <form action="/addNote/<%= customerPurchasesArr[customer].address %>" method="post">
                    <textarea name="addNote" type="text" placeholder="Add A Note About The Customer"></textarea>
                    <input type="submit" value="ADD NOTE">
                    <input type="hidden" name="pagePath" value="<%= pagePath %>">
                  </form>
                </div>
              </div>
  
              <div class="purchased-items">
                <h4 class="sub-head">This customer has made these purchases that triggered a suggestion:</h4>
                <% for(item in customerPurchasesArr[customer].subscriptions){ %>
                  <div class="single-customer-purchased-item">
                    <div class="single-customer-purchase">
                      <p><span style="font-weight: 600;">Product:</span> <%= customerPurchasesArr[customer].subscriptions[item].productName %></p>
                      <p>Subscription Number: <%= customerPurchasesArr[customer].subscriptions[item].subNum %></p>
                      <p>Price: $<%= customerPurchasesArr[customer].subscriptions[item].subtotal %></p>
                      <p>Run Count: <%= customerPurchasesArr[customer].subscriptions[item].run_count %></p>
                      <p><span style="font-weight: 600;">Interval:</span> <%= customerPurchasesArr[customer].subscriptions[item].interval %></p>
                    </div>
    
                    <div class="single-purchase-edit-box">
                      <p class="status purchase-status <%= pagePath %>">STATUS: <%= customerPurchasesArr[customer].subscriptions[item].status %></p>
                      <form action="/changeStatus/<%= customerPurchasesArr[customer].address %>" method="POST">
                        <select name="status" id="status">
                          <option value="new">--New Suggestion --</option>
                          <option value="contacted">Contacted</option>
                          <option value="potential">Potential</option>
                          <option value="paused">Paused</option>
                          <option value="not-interested">Not Interested</option>
                        </select>
                        <input type="hidden" name="subNum" value="<%= customerPurchasesArr[customer].subscriptions[item].subNum %>">
                        <input type="submit" value="CHANGE STATUS">
                      </form>

                      <p><span style="font-weight: 600;">NOTES:</span> <%= customerPurchasesArr[customer].subscriptions[item].notes %></p>
                      
                      <form action="/addSubNote/<%= customerPurchasesArr[customer].address %>" method="post">
                        <textarea name="addSubNote" type="text" placeholder="<%=  %>Add A Note About The Subscription <%= customerPurchasesArr[customer].subscriptions[item].notes %>"></textarea>
                        <input type="submit" value="ADD NOTE">
                        <input type="hidden" name="pagePath" value="<%= pagePath %>">
                        <input type="hidden" name="subNum" value="<%= customerPurchasesArr[customer].subscriptions[item].subNum %>">
                      </form>
                    </div>
                  </div>
                <% } %>
              </div>
            </div>

          <%}
        %>

          <br>
        <% }
      } %>
    </div>
    <script src="../public/script.js"></script>
</body>
</html>